mysql:
  image: mysql:5.5.42
  restart: always
  env_file: [ mysql_password.env ]
  volumes:
    - ${LEAF_DATA_DIR}/mysql:/var/lib/mysql

redis:
  image: redis:2.8.19
  restart: always
  volumes:
    - ${LEAF_DATA_DIR}/redis:/data

app:
  build: .
  command: echo image container

sidekiq:
  image: leaf_app:latest
  links: [ mysql, redis ]
  restart: always
  environment:
    - ROLE=sidekiq
  volumes:
    - ${LEAF_DATA_DIR}/web-app:/home/app

passenger:
  image: leaf_app:latest
  links: [ mysql, redis ]
  restart: always
  environment:
    - VIRTUAL_HOST=www.ll100.cn
    - ROLE=nginx
  volumes:
    - ${LEAF_DATA_DIR}/web-app:/home/app
  ports:
    - "4022:22"
    - "8081:80"

sftp:
  image: leaf_app:latest
  restart: always
  env_file: [ sftp.env ]
  environment:
    - ROLE=sftp
  volumes:
    - ${LEAF_DATA_DIR}/web-app/shared/import:/home/app/shared/import
  ports:
    - "4023:22"

phpmyadmin:
  image: splattael/phpmyadmin:latest
  restart: always
  links: [ mysql ]
  ports: [ "8080:80" ]
  environment:
    - VIRTUAL_HOST=dev.ll100.cn
